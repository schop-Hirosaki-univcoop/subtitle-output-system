<?
  var shellCtx = typeof context !== 'undefined' && context ? context : {};
  var injectedBodyMarkup = typeof bodyMarkup !== 'undefined' && bodyMarkup !== null
    ? bodyMarkup
    : (shellCtx.bodyMarkup || '');
  var shellSubjectEventNameMatch = shellCtx.subject ? String(shellCtx.subject).match(/【([^】]+)】/) : null;
  var shellSubjectEventName = shellSubjectEventNameMatch ? shellSubjectEventNameMatch[1].trim() : '';
  var resolvedEventName =
    shellCtx.resolvedEventName ||
    shellCtx.eventName ||
    shellCtx.eventLabel ||
    shellCtx.eventId ||
    shellSubjectEventName ||
    'イベント';
  var resolvedScheduleLabel =
    shellCtx.resolvedScheduleLabel ||
    shellCtx.scheduleLabel ||
    shellCtx.scheduleRangeLabel ||
    '';
  var resolvedSubject = shellCtx.subject ? String(shellCtx.subject) : '';
  if (!resolvedSubject) {
    resolvedSubject = resolvedScheduleLabel
      ? (resolvedEventName || 'ご案内') + ' - ' + resolvedScheduleLabel
      : (resolvedEventName || 'ご案内');
  }
  if (shellCtx.resolvedSubject && !shellCtx.subject) {
    resolvedSubject = String(shellCtx.resolvedSubject);
  }
  var preheaderFallback = resolvedEventName ? resolvedEventName + 'のご案内です。' : 'ご案内です。';
  var bodyStyle = [
    'margin:0',
    'padding:0',
    'background:#f9f9f9',
    'color:#333333',
    "font-family:\'Arial\',\'Helvetica\',\'Meiryo\',\'sans-serif\'",
    'line-height:1.6',
    '-webkit-font-smoothing:antialiased'
  ].join('; ');
  var wrapperPadding = shellCtx.mode === 'web'
    ? 'padding:56px 16px 120px'
    : 'padding:24px 16px 80px';
  var wrapperStyle = [
    'max-width:640px',
    'margin:0 auto',
    wrapperPadding
  ].join('; ');
  var preheaderStyle = [
    'display:none !important',
    'max-height:0 !important',
    'opacity:0 !important',
    'overflow:hidden !important',
    'color:transparent !important',
    'height:0 !important',
    'width:0 !important'
  ].join('; ');
  var webNoteStyle = [
    'max-width:640px',
    'margin:32px auto 0',
    'font-size:13px',
    'color:#555555',
    'text-align:center'
  ].join('; ');
?>
<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <? if (shellCtx.mode === 'web') { ?>
      <meta name="viewport" content="width=device-width, initial-scale=1">
    <? } ?>
    <title><?= resolvedSubject ?></title>
  </head>
  <body style="<?= bodyStyle ?>">
    <? if (shellCtx.mode !== 'web') { ?>
      <span class="mail-preheader" style="<?= preheaderStyle ?>"><?= shellCtx.previewText || preheaderFallback ?></span>
    <? } ?>
    <div
      class="mail-wrapper mail-wrapper--<?= shellCtx.mode === 'web' ? 'web' : 'email' ?>"
      style="<?= wrapperStyle ?>"
    >
      <?!= injectedBodyMarkup ?>
    </div>
    <? if (shellCtx.mode === 'web') { ?>
      <p class="web-note" style="<?= webNoteStyle ?>">このページのURLは参加者向けメールにも記載されています。共有の際はリンクの取り扱いにご注意ください。</p>
    <? } ?>
  </body>
</html>
