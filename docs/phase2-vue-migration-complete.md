# フェーズ 2: Vue コンポーネント移行完了

## 完了した作業

### 1. Vue コンポーネントの作成

- ✅ **QuestionCard.vue**: 個別の質問カードコンポーネント
- ✅ **QuestionList.vue**: 質問リスト全体を管理するコンポーネント
- ✅ **useOperatorApp.js**: OperatorApp インスタンスにアクセスする composable

### 2. operator.html への統合

- ✅ Vue アプリを`op-questions-cards`コンテナにマウント
- ✅ 既存の`renderQuestions`を Vue コンポーネントに置き換え
- ✅ 既存コードとの共存を確認

### 3. ビルドの確認

- ✅ Vite ビルドが正常に動作することを確認
- ✅ `operator.html`が正常にビルドされることを確認

## 実装内容

### コンポーネント構造

```
src/
├── components/
│   ├── QuestionCard.vue      # 個別の質問カード
│   └── QuestionList.vue      # 質問リスト全体
└── composables/
    └── useOperatorApp.js     # OperatorAppアクセス用
```

### 主な機能

1. **QuestionCard.vue**

   - 質問カードの表示
   - ステータス表示（未送出、送出準備中、送出済）
   - ラジオネーム、ジャンル、質問テキスト、班番号の表示
   - クリックイベントとチェックボックスイベントの処理

2. **QuestionList.vue**

   - 質問リストのフィルタリング（タブ、ジャンル、日程）
   - リアクティブな更新（500ms ごと）
   - 既存の OperatorApp インスタンスとの連携

3. **useOperatorApp.js**
   - `window.operatorEmbed.app`から OperatorApp インスタンスを取得
   - Vue コンポーネントから既存のアプリ状態にアクセス

## 動作確認

### 開発サーバーでの確認

```bash
npm run dev
```

ブラウザで `http://localhost:3000/operator.html` にアクセスして確認してください。

### 確認項目

1. **質問カードの表示**

   - [ ] 質問カードが正しく表示される
   - [ ] 既存のスタイル（`q-card`クラス）が適用される
   - [ ] ラジオネーム、ジャンル、質問テキストが正しく表示される

2. **リアクティブな更新**

   - [ ] 新しい質問が追加されると自動的に表示される
   - [ ] 質問のステータスが変更されると自動的に更新される
   - [ ] タブやジャンルのフィルターが正しく機能する

3. **既存機能との統合**

   - [ ] カードをクリックすると選択状態が更新される
   - [ ] チェックボックスが機能する
   - [ ] 既存のアクションボタン（送出、未回答へ戻すなど）が機能する

4. **パフォーマンス**
   - [ ] 500ms ごとの更新が適切か確認
   - [ ] 大量の質問がある場合のパフォーマンスを確認

## 次のステップ

### 優先度: 高

1. **パフォーマンスの最適化**

   - 500ms ごとの更新を、Firebase リスナーやイベントベースの更新に変更
   - 不要な再レンダリングを削減

2. **既存コードの完全な置き換え**
   - `renderQuestions`関数を完全に削除
   - 既存のイベントハンドラを Vue コンポーネントに統合

### 優先度: 中

3. **TypeScript の導入**（オプション）

   - 型安全性の向上
   - 開発体験の向上

4. **コンポーネントの整理**
   - ディレクトリ構造の整理
   - コンポーネントの再利用性向上

## 注意事項

- **実験的な実装**: 現在は 500ms ごとの更新を使用していますが、本番環境ではより効率的な更新方法を採用してください
- **既存コードとの共存**: 既存の`renderQuestions`をラップしていますが、段階的に完全に置き換えることを推奨します
- **パフォーマンス**: 大量の質問がある場合、パフォーマンスに影響が出る可能性があります

## トラブルシューティング

### Vue コンポーネントが表示されない

1. **開発者ツールのコンソールを確認**

   - `[Vue]`で始まるメッセージを確認
   - エラーメッセージがないか確認

2. **OperatorApp インスタンスの確認**

   ```javascript
   // ブラウザのコンソールで確認
   console.log(window.operatorEmbed?.app);
   ```

3. **コンテナの確認**
   ```javascript
   // ブラウザのコンソールで確認
   console.log(document.getElementById("op-questions-cards"));
   ```

### 既存のカードと Vue コンポーネントが両方表示される

- `window.__vueExperimentEnabled`が`true`に設定されているか確認
- 既存の`app.renderQuestions`が正しくラップされているか確認

### リアクティブな更新が機能しない

- `QuestionList.updateQuestions()`が定期的に呼ばれているか確認
- `app.state.allQuestions`が正しく更新されているか確認

---

**作成日**: 2025 年 12 月  
**バージョン**: 1.0.0
