# 画面仕様書

## 1. トップページ（index.html）

### 1.1 画面概要

システムのトップページ。アクセス案内を表示する。

### 1.2 URL

`/index.html`

### 1.3 画面レイアウト

```
┌─────────────────────────────────────┐
│  Header: Subtitle Ops               │
│  Context: Access Guide              │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │  アクセスのご案内           │   │
│  │                             │   │
│  │  このトップページには       │   │
│  │  コンテンツを用意していません│   │
│  │  招待されたURLやメールに記載│   │
│  │  されたリンクから直接アクセス│   │
│  │  してください。            │   │
│  │                             │   │
│  │  リンクに心当たりがない場合 │   │
│  │  やお困りの際は、イベント担当│   │
│  │  スタッフまでお知らせください│   │
│  └─────────────────────────────┘   │
│                                     │
├─────────────────────────────────────┤
│  Footer: © 2025                     │
└─────────────────────────────────────┘
```

### 1.4 機能

- アクセス案内の表示
- 他画面への案内

### 1.5 認証・認可

- 不要

---

## 2. ログインページ（login.html）

### 2.1 画面概要

オペレーターが Google アカウントでログインするページ。

### 2.2 URL

`/login.html`

### 2.3 画面レイアウト

```
┌─────────────────────────────────────┐
│  Header: Event Control              │
│  Context: サインイン                │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │  イベントコントロール       │   │
│  │  センターへログイン         │   │
│  │                             │   │
│  │  イベントや日程の管理、     │   │
│  │  テロップ操作ツールの利用に │   │
│  │  は管理用Googleアカウントでの│   │
│  │  サインインが必要です。     │   │
│  │                             │   │
│  │  [Googleアカウントでログイン]│   │
│  │                             │   │
│  │  ログイン処理の進捗:        │   │
│  │  □ Googleアカウントを確認    │   │
│  │  □ 管理者権限を確認         │   │
│  │  □ アクセス権限を照合       │   │
│  │  □ イベント情報を取得       │   │
│  │  □ 資格情報を保存           │   │
│  │  □ イベント管理画面へ移動   │   │
│  │                             │   │
│  │  [エラーメッセージ表示領域] │   │
│  └─────────────────────────────┘   │
│                                     │
├─────────────────────────────────────┤
│  Footer: © 2025                     │
└─────────────────────────────────────┘
```

### 2.4 機能

#### 2.4.1 ログインボタン

- **ボタンラベル**: "Google アカウントでログイン"
- **キーボードショートカット**: `L` キー
- **動作**: Google OAuth 認証を開始

#### 2.4.2 ログイン進捗表示

- Google アカウントの確認
- 管理者権限の確認
- アクセス権限の照合
- イベント情報の取得
- 資格情報の保存
- イベント管理画面へのリダイレクト

#### 2.4.3 エラー表示

- 認証エラー時にエラーメッセージを表示

### 2.5 認証・認可

- Google OAuth 認証
- 管理者権限チェック（プリフライト認証）

### 2.6 遷移

- **成功時**: `operator.html` または `index.html`（イベント管理）
- **エラー時**: エラーメッセージ表示（同一ページ）

---

## 3. オペレーター管理画面（operator.html）

### 3.1 画面概要

オペレーターがイベント管理、質問管理、テロップ操作を行う統合管理画面。

### 3.2 URL

`/operator.html`

### 3.3 画面レイアウト

```
┌─────────────────────────────────────────────────────┐
│  Header: Event Control                              │
│  Context: [現在選択中のイベント・日程]              │
│  [バックアップ] [復元] [フルスクリーン]            │
│  [ユーザー情報] [ログアウト]                        │
├─────────────────────────────────────────────────────┤
│  [タブ/パネル切り替え]                              │
│  ┌─────────────────┬──────────────────┬──────────┐ │
│  │ サイドバー      │  メインコンテンツ │ チャット  │ │
│  │                 │  エリア          │          │ │
│  │ ・イベント      │  [選択された      │ [メッセージ│ │
│  │ ・日程          │   パネルの内容]   │  表示]   │ │
│  │ ・参加者リスト  │                  │          │ │
│  │ ・質問管理      │                  │ [入力欄] │ │
│  │ ・テロップ操作  │                  │          │ │
│  │ ・GL管理        │                  │          │ │
│  │ ・ルビ辞書      │                  │          │ │
│  │ ・ログ          │                  │          │ │
│  │                 │                  │          │ │
│  └─────────────────┴──────────────────┴──────────┘ │
├─────────────────────────────────────────────────────┤
│  Footer: © 2025                                     │
└─────────────────────────────────────────────────────┘
```

### 3.4 主要パネル

#### 3.4.1 イベント管理パネル

- イベント一覧の表示
- イベントの作成・編集・削除
- イベント名の設定

#### 3.4.2 日程管理パネル

- 日程一覧の表示
- 日程の作成・編集・削除
- 日程情報（ラベル、日付、時刻、会場）の設定

#### 3.4.3 参加者リストパネル

- 参加者一覧の表示（表形式）
- 参加者の登録・編集・削除
- 専用リンクの発行
- メール送信
- 重複参加者の検出
- CSV インポート・エクスポート機能
  - 参加者 CSV テンプレートのダウンロード
  - 参加者 CSV のアップロード（参加者情報の一括登録・更新）
  - 班番号 CSV テンプレートのダウンロード
  - 班番号 CSV のアップロード（班番号の一括割り当て）

#### 3.4.4 質問管理パネル

- 質問一覧の表示
- ジャンル別フィルタリング
- 回答済み/未回答のフィルタリング
- 質問の削除
- Pick Up Question への変換

#### 3.4.5 テロップ操作パネル

- 質問の選択と表示
- 表示中の質問の非表示
- キーボードショートカット対応
- サイドテロップの編集

#### 3.4.6 GL 管理パネル

- GL 応募者の一覧表示
- 班割りステータスの管理
- シフト可否の確認

#### 3.4.7 ルビ辞書パネル

- ルビ辞書の一覧表示
- 語句とルビの登録・編集・削除
- 有効/無効の切り替え

#### 3.4.8 ログパネル

- 操作ログの一覧表示
- ログのフィルタリング・検索

#### 3.4.9 オペレーターチャットパネル

- チャットメッセージの表示
- メッセージの送信
- 未読メッセージ数の表示
- 返信機能

#### 3.4.10 印刷機能

- 参加者リストの印刷プレビュー
- スタッフリストの印刷プレビュー
- 印刷設定ダイアログ
- 印刷実行

#### 3.4.11 バックアップ・復元機能

- バックアップボタン（ヘッダー）
- 復元ボタン（ヘッダー）
- バックアップ・復元確認ダイアログ

### 3.5 認証・認可

- Google OAuth 認証必須
- 管理者権限必須

### 3.6 遷移

- **ログアウト時**: `login.html`
- **認証エラー時**: `login.html`

---

## 4. 質問投稿フォーム（question-form.html）

### 4.1 画面概要

参加者が質問を投稿するフォーム。

### 4.2 URL

`/question-form.html?token={token}`

### 4.3 画面レイアウト

```
┌─────────────────────────────────────┐
│  Header: Question Intake Desk       │
│  Context: フォーム情報              │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │  質問受付フォーム           │   │
│  │                             │   │
│  │  [コンテキストバナー]        │   │
│  │  こんにちは、{参加者名}さん │   │
│  │  {イベント名} - {日程情報}   │   │
│  │                             │   │
│  │  ラジオネーム [必須]        │   │
│  │  [____________________]     │   │
│  │  (20文字まで)               │   │
│  │                             │   │
│  │  質問・お悩み [必須]        │   │
│  │  [________________________] │   │
│  │  [________________________] │   │
│  │  (60文字まで) 0 / 60文字    │   │
│  │                             │   │
│  │  ジャンル [必須]            │   │
│  │  [▼ ジャンルを選択してください]│
│  │                             │   │
│  │  [送信する]                 │   │
│  │                             │   │
│  │  [送信結果メッセージ]       │   │
│  └─────────────────────────────┘   │
│                                     │
├─────────────────────────────────────┤
│  Footer: © 2025                     │
└─────────────────────────────────────┘
```

### 4.4 フォーム項目

#### 4.4.1 ラジオネーム

- **型**: テキスト入力
- **必須**: はい
- **最大文字数**: 20 文字
- **バリデーション**: 必須チェック、文字数制限

#### 4.4.2 質問・お悩み

- **型**: テキストエリア（6 行）
- **必須**: はい
- **最大文字数**: 60 文字
- **プレースホルダー**: "質問や相談内容を入力してください"
- **文字数カウンター**: リアルタイム表示（0 / 60 文字）
- **バリデーション**: 必須チェック、文字数制限

#### 4.4.3 ジャンル

- **型**: セレクトボックス
- **必須**: はい
- **選択肢**:
  - 学び
  - 活動
  - 暮らし
  - 食・スポット
  - 移動・季節
  - その他
- **バリデーション**: 必須チェック

### 4.5 機能

#### 4.5.1 コンテキスト情報の表示

- 参加者への挨拶（コンテキストバナー）
- イベント名と日程情報の表示
- 参加者名の表示（トークンから取得）

#### 4.5.2 フォーム送信

- 送信ボタンクリックで送信
- バリデーション実行
- 送信中の状態表示
- 送信完了メッセージ
- エラーメッセージ表示

#### 4.5.3 文字数カウンター

- 質問本文の文字数をリアルタイムで表示
- 60 文字に達したら入力制限

### 4.6 認証・認可

- トークンベース認証
- トークンの有効性チェック

### 4.7 遷移

- **送信成功時**: 同一ページ（送信完了メッセージ表示）
- **トークン無効時**: エラーメッセージ表示（フォーム非表示）

---

## 5. テロップ表示画面（display.html）

### 5.1 画面概要

質問をテロップとして表示する画面。イベント会場のスクリーンなどで使用。

### 5.2 URL

`/display.html?eventId={eventId}&scheduleId={scheduleId}`

### 5.3 画面レイアウト

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│  [サイドテロップ左]        [サイドテロップ右]      │
│  {イベント名}              {ステータスメッセージ}  │
│  {日程情報}                                        │
│                                                     │
│                                                     │
│                                                     │
│                                                     │
│         ┌─────────────────────────────────┐        │
│         │ ラジオネーム: {ラジオネーム}   │        │
│         ├─────────────────────────────────┤        │
│         │ [ジャンル]  {質問本文}          │        │
│         │            （ルビ付き）          │        │
│         └─────────────────────────────────┘        │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 5.4 表示要素

#### 5.4.1 サイドテロップ（左）

- **位置**: 画面上部左
- **内容**: イベント名、日程情報
- **デザイン**: ネオン枠付きガラス調

#### 5.4.2 サイドテロップ（右）

- **位置**: 画面上部右
- **内容**: ステータスメッセージ
- **デザイン**: グラデーション背景、ドロップシャドウ

#### 5.4.3 メインテロップ

- **ラジオネームタグ**: 上部にタブ形式で表示
- **ジャンルパネル**: 左側に表示（任意）
- **質問本文**: 中央に大きく表示（1 行 23 文字制約）
- **ルビ**: 自動適用
- **デザイン**: ネオン枠付き、グラデーション背景

### 5.5 機能

#### 5.5.1 リアルタイム表示

- Firebase Realtime Database の `nowShowing` を監視
- 質問データを自動取得して表示
- 表示の切り替えアニメーション（FLIP アニメーション）

#### 5.5.2 表示アニメーション

- **入場アニメーション**: テロップの表示時
- **退場アニメーション**: テロップの非表示時
- **切り替えアニメーション**: テキストのクロスフェード

#### 5.5.3 ルビ適用

- ルビ辞書（`dictionary`）を監視
- 質問本文にルビを自動適用
- HTML `<ruby>` タグで表示

#### 5.5.4 サイドテロップ更新

- サイドテロップの内容をリアルタイムで更新
- プリセットの切り替え対応

### 5.6 表示状態管理

- **hidden**: 非表示
- **showing**: 表示中（アニメーション中）
- **visible**: 表示中
- **hiding**: 非表示中（アニメーション中）
- **error**: エラー

### 5.7 認証・認可

- 匿名認証
- ディスプレイセッション管理

### 5.8 パラメータ

- `eventId`: イベント ID（必須）
- `scheduleId`: 日程 ID（オプション）
- `lowgpu`: 低負荷モード（`?lowgpu=1`）

---

## 6. GL 応募フォーム（gl-form.html）

### 6.1 画面概要

GL（グループリーダー）の応募フォーム。

### 6.2 URL

`/gl-form.html?slug={slug}`

### 6.3 画面レイアウト

```
┌─────────────────────────────────────┐
│  Header: GL Application             │
│  Context: フォーム情報              │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │  GL応募フォーム             │   │
│  │                             │   │
│  │  [コンテキストバナー]        │   │
│  │  {イベント名}               │   │
│  │  {期間情報}                 │   │
│  │                             │   │
│  │  氏名 [必須]                │   │
│  │  [____________________]     │   │
│  │                             │   │
│  │  フリガナ                   │   │
│  │  [____________________]     │   │
│  │                             │   │
│  │  メールアドレス [必須]      │   │
│  │  [____________________]     │   │
│  │                             │   │
│  │  学年                       │   │
│  │  [▼ 学年を選択してください] │   │
│  │                             │   │
│  │  学部 [必須]                │   │
│  │  [▼ 学部を選択してください] │   │
│  │                             │   │
│  │  学科 [必須]（動的生成）    │   │
│  │  [▼ 学科を選択してください] │   │
│  │                             │   │
│  │  学籍番号                   │   │
│  │  [____________________]     │   │
│  │                             │   │
│  │  所属している部活・サークル │   │
│  │  [____________________]     │   │
│  │                             │   │
│  │  参加可能な日程（複数選択可）│   │
│  │  ☐ {日程1} {時刻}          │   │
│  │  ☐ {日程2} {時刻}          │   │
│  │                             │   │
│  │  備考・連絡事項             │   │
│  │  [________________________] │   │
│  │                             │   │
│  │  ☑ 個人情報の取扱いについて │   │
│  │     同意します              │   │
│  │                             │   │
│  │  [送信する]                 │   │
│  └─────────────────────────────┘   │
│                                     │
├─────────────────────────────────────┤
│  Footer: © 2025                     │
└─────────────────────────────────────┘
```

### 6.4 フォーム項目

#### 6.4.1 基本情報

- **氏名**: 必須、テキスト入力
- **フリガナ**: 任意、テキスト入力
- **メールアドレス**: 必須、メール形式
- **学年**: 任意、セレクトボックス
- **学部**: 必須、セレクトボックス（動的生成）
- **学科**: 必須、セレクトボックス（学部選択後に動的生成）
- **学籍番号**: 任意、テキスト入力
- **所属している部活・サークル**: 任意、テキスト入力

#### 6.4.2 参加可能日程

- **型**: チェックボックス（複数選択可）
- **表示**: 日程ラベル、日付、時刻
- **動的生成**: イベント設定から取得

#### 6.4.3 その他

- **備考・連絡事項**: 任意、テキストエリア
- **個人情報の取扱いについて同意します**: 必須、チェックボックス

### 6.5 機能

#### 6.5.1 学部・学科の動的生成

- 学部選択により学科の選択肢が動的に変化
- 階層構造に対応

#### 6.5.2 フォーム送信

- バリデーション実行
- 送信完了メッセージ

### 6.6 認証・認可

- スラッグ（slug）ベース認証

---

## 7. 参加者メール閲覧ページ（participant-mail-view.html）

### 7.1 画面概要

メールが正しく表示されない場合に参加者がメール内容を確認するためのページ。

### 7.2 URL

`/participant-mail-view.html?token={token}`

### 7.3 画面レイアウト

```
┌─────────────────────────────────────┐
│  Header: 参加者メール閲覧ページ     │
│  メールが正しく表示されない場合の   │
│  確認用リンクです。URLの共有は     │
│  お控えください。                  │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │  読み込みステータス         │   │
│  │  アクセス情報を確認しています│   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  メール件名                 │   │
│  │  {メール件名}               │   │
│  │                             │   │
│  │  表示内容は参加者本人専用   │   │
│  │  です。第三者への共有や     │   │
│  │  転載はお控えください。     │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  メール本文                 │   │
│  │  ┌─────────────────────┐   │   │
│  │  │                     │   │   │
│  │  │  {メール本文}       │   │   │
│  │  │  (iframe内)         │   │   │
│  │  │                     │   │   │
│  │  └─────────────────────┘   │   │
│  └─────────────────────────────┘   │
│                                     │
├─────────────────────────────────────┤
│  Footer: © 2025                     │
└─────────────────────────────────────┘
```

### 7.4 機能

#### 7.4.1 メール内容の取得

- トークンからメール情報を取得
- メール件名の表示
- メール本文の表示（iframe 内）

#### 7.4.2 ステータス表示

- 読み込み中の表示
- エラー時のメッセージ表示

### 7.5 認証・認可

- トークンベース認証

---

## 8. 共通 UI 要素

### 8.1 ヘッダー（telop-header）

```
┌─────────────────────────────────────┐
│  [Logo]  Subtitle Ops  [Context]    │
└─────────────────────────────────────┘
```

- **Tagline**: システム名（例: "Subtitle Ops", "Event Control"）
- **Context Label**: 現在のページ/状態

### 8.2 フッター（telop-footer）

```
┌─────────────────────────────────────┐
│           © 2025                    │
└─────────────────────────────────────┘
```

### 8.3 ボタン

- **Primary Button**: 主要アクション用
- **Secondary Button**: 副次アクション用
- **Disabled State**: 無効状態

### 8.4 モジュール（module）

- **module-header**: モジュールヘッダー（タイトル、説明）
- **module-body**: モジュール本文
- **module-footer**: モジュールフッター（オプション）

### 8.5 フォーム要素

- **入力フィールド**: ラベル、必須タグ、ヒント、エラーメッセージ
- **セレクトボックス**: プレースホルダー対応
- **チェックボックス**: ラベル付き
- **テキストエリア**: 行数指定、文字数カウンター

### 8.6 エラーメッセージ

- **表示場所**: フォーム要素の直下、または専用エリア
- **スタイル**: 赤色、視認性の高いデザイン
- **ARIA**: `role="alert"`, `aria-live="assertive"`

### 8.7 ローディング表示

- **スピナー**: 処理中の表示
- **プログレスバー**: 進捗表示
- **ステータスメッセージ**: 処理内容の説明

---

## 9. レスポンシブデザイン

### 9.1 ブレークポイント

- **モバイル**: ~768px
- **タブレット**: 769px ~ 1024px
- **デスクトップ**: 1025px~

### 9.2 対応内容

- フォントサイズの調整（clamp 使用）
- レイアウトの変更（縦積みなど）
- タッチ操作の最適化
- テロップ表示のスケーリング

---

## 10. キーボードショートカット

### 10.1 ログインページ

- **L**: ログインボタンのクリック

### 10.2 オペレーター画面

- **L**: ログアウト
- **F**: フルスクリーン切り替え
- **各パネルで個別に定義**（実装に依存）

### 10.3 テロップ操作パネル

- **各操作で個別に定義**（実装に依存）

## 11. 404 エラーページ（404.html）

### 11.1 画面概要

存在しない URL にアクセスした際に表示されるカスタム 404 エラーページ。

### 11.2 URL

`/404.html` または存在しないパス

### 11.3 画面レイアウト

```
┌─────────────────────────────────────┐
│  Header: Subtitle Ops               │
│  Context: 404 Not Found             │
├─────────────────────────────────────┤
│                                     │
│  [背景演出: 星屑アニメーション]     │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  [イラスト: 迷子になった    │   │
│  │    テロップのイラスト]      │   │
│  │                             │   │
│  │  404                        │   │
│  │  あれ、テロップはどこへ…？  │   │
│  │                             │   │
│  │  どうやらこのアドレスには   │   │
│  │  テロップが存在しない       │   │
│  │  ようです。                 │   │
│  │  お手数ですが、別のページ   │   │
│  │  から改めてアクセスして     │   │
│  │  みてください。             │   │
│  │                             │   │
│  │  それでも見つからない場合は │   │
│  │  URLを再確認のうえスタッフ │   │
│  │  までお知らせください。     │   │
│  └─────────────────────────────┘   │
│                                     │
├─────────────────────────────────────┤
│  Footer: © 2025                     │
└─────────────────────────────────────┘
```

### 11.4 機能

- エラーメッセージの表示
- 案内メッセージの表示
- 視覚的なエフェクト（星屑アニメーション、グラデーション背景）

### 11.5 認証・認可

- 不要

---

## 12. 印刷プレビュー画面

### 12.1 画面概要

参加者リストやスタッフリストの印刷プレビューを表示するダイアログ。オペレーター管理画面（operator.html）内の質問管理パネルからアクセス可能。

### 12.2 表示場所

- オペレーター管理画面（operator.html）内に埋め込み表示
- 質問管理パネル内の印刷機能として提供

### 12.3 表示方法

- オーバーレイダイアログとして表示
- 全画面表示も可能

### 12.4 機能

#### 12.4.1 プレビュー表示

- 印刷用 HTML の表示
- 用紙サイズに合わせたレイアウト表示
- ページ分割の表示

#### 12.4.2 印刷設定

- 用紙サイズ選択（A4, A3, Letter, カスタムなど）
- 向き選択（縦、横）
- 余白設定
- スケール設定

#### 12.4.3 印刷実行

- 印刷ボタンで印刷ダイアログを開く
- 自動印刷オプション

### 12.5 データ表示内容

#### 12.5.1 参加者リスト

- 参加者情報（氏名、フリガナ、メールアドレスなど）
- 日程情報
- 班番号

#### 12.5.2 スタッフリスト

- スタッフ情報
- 役割情報
