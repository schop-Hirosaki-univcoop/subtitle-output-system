{
  "rules": {
    ".read": false,
    ".write": false,

    "render": {
      "state": {
        ".read": true,
        ".write": "auth != null && ((auth.token.firebase.sign_in_provider === 'anonymous' && root.child('screens/approved').child(auth.uid).val() == true) || root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
        ".validate": "newData.hasChildren(['phase'])",
        "phase": {
          ".validate": "newData.isString() && newData.val().matches(/^(visible|hidden|showing|hiding|error)$/)"
        },
        "updatedAt": { ".validate": "newData.isNumber() || !newData.exists()" },
        "nowShowing": {
          ".validate": "!newData.exists() || (newData.hasChildren(['name','question']) && newData.child('name').isString() && newData.child('question').isString() && (!newData.child('uid').exists() || newData.child('uid').isString()) && (!newData.child('participantId').exists() || newData.child('participantId').isString()) && (!newData.child('genre').exists() || newData.child('genre').isString()) && (!newData.child('pickup').exists() || newData.child('pickup').isBoolean()))",
          "uid": { ".validate": "newData.isString()" },
          "participantId": { ".validate": "newData.isString()" },
          "genre": { ".validate": "newData.isString()" },
          "pickup": { ".validate": "newData.isBoolean()" }
        }
      },
      "events": {
        "$eventId": {
          ".read": true,
          "$scheduleId": {
            ".read": true,
            "state": {
              ".read": true,
              ".write": "auth != null && ((auth.token.firebase.sign_in_provider === 'anonymous' && root.child('screens/approved').child(auth.uid).val() == true) || root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
              ".validate": "newData.hasChildren(['phase'])",
              "phase": {
                ".validate": "newData.isString() && newData.val().matches(/^(visible|hidden|showing|hiding|error)$/)"
              },
              "updatedAt": { ".validate": "newData.isNumber() || !newData.exists()" },
              "nowShowing": {
                ".validate": "!newData.exists() || (newData.hasChildren(['name','question']) && newData.child('name').isString() && newData.child('question').isString() && (!newData.child('uid').exists() || newData.child('uid').isString()) && (!newData.child('participantId').exists() || newData.child('participantId').isString()) && (!newData.child('genre').exists() || newData.child('genre').isString()) && (!newData.child('pickup').exists() || newData.child('pickup').isBoolean()))",
                "uid": { ".validate": "newData.isString()" },
                "participantId": { ".validate": "newData.isString()" },
                "genre": { ".validate": "newData.isString()" },
                "pickup": { ".validate": "newData.isBoolean()" }
              }
            },
            "nowShowing": {
              ".read": true,
              ".write": "auth != null && ((auth.token.firebase.sign_in_provider === 'anonymous' && root.child('screens/approved').child(auth.uid).val() == true) || root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
              ".validate": "!newData.exists() || (newData.hasChildren(['name','question']) && newData.child('name').isString() && newData.child('question').isString() && (!newData.child('uid').exists() || newData.child('uid').isString()) && (!newData.child('participantId').exists() || newData.child('participantId').isString()) && (!newData.child('genre').exists() || newData.child('genre').isString()) && (!newData.child('pickup').exists() || newData.child('pickup').isBoolean()))",
              "name": { ".validate": "newData.isString()" },
              "question": { ".validate": "newData.isString()" },
              "uid": { ".validate": "newData.isString() || !newData.exists()" },
              "participantId": { ".validate": "newData.isString() || !newData.exists()" },
              "genre": { ".validate": "newData.isString() || !newData.exists()" },
              "pickup": { ".validate": "newData.isBoolean() || !newData.exists()" }
            }
          }
        }
      },
      "session": {
        ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
        ".write": "auth != null && auth.token.admin == true"
      }
    },

    "operatorChat": {
      ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
      ".write": "auth != null && root.child('admins').child(auth.uid).val() == true",
      "messages": {
        ".indexOn": ["timestamp"],
        "$messageId": {
          ".validate": "newData.hasChildren(['uid','message','timestamp']) && newData.child('uid').isString() && newData.child('message').isString() && newData.child('message').val().length > 0 && newData.child('message').val().length <= 1000 && (newData.child('timestamp').isNumber() || newData.child('timestamp').val() == now)",
          "uid": { ".validate": "newData.isString()" },
          "displayName": { ".validate": "newData.isString() || !newData.exists()" },
          "email": { ".validate": "newData.isString() || !newData.exists()" },
          "message": { ".validate": "newData.isString()" },
          "timestamp": { ".validate": "newData.isNumber() || newData.val() == now" },
          "replyTo": {
            ".validate": "!newData.exists() || (newData.hasChildren(['id','message']) && newData.child('id').isString() && newData.child('id').val().length > 0 && newData.child('message').isString() && newData.child('message').val().length > 0 && newData.child('message').val().length <= 300 && (!newData.child('author').exists() || newData.child('author').isString()))",
            "id": { ".validate": "newData.isString()" },
            "author": { ".validate": "newData.isString() || !newData.exists()" },
            "message": { ".validate": "newData.isString()" },
            "$other": { ".validate": false }
          },
          "$other": { ".validate": false }
        }
      },
      "reads": {
        "$uid": {
          ".read": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true) && auth.uid == $uid",
          ".write": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true) && auth.uid == $uid",
          ".validate": "!newData.exists() || (newData.hasChildren(['lastReadMessageId']) && newData.child('lastReadMessageId').isString() && newData.child('lastReadMessageId').val().length > 0 && (!newData.child('updatedAt').exists() || newData.child('updatedAt').isNumber() || newData.child('updatedAt').val() == now) && (!newData.child('lastReadMessageTimestamp').exists() || newData.child('lastReadMessageTimestamp').isNumber()))",
          "lastReadMessageId": { ".validate": "newData.isString() && newData.val().length > 0" },
          "lastReadMessageTimestamp": { ".validate": "newData.isNumber() || !newData.exists()" },
          "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "$other": { ".validate": false }
        }
      }
    },

    "glIntake": {
      "events": {
        "$eventId": {
          ".read": "(auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (data.child('slug').isString() && data.child('slug').val().length > 0)",
          ".write": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
          ".validate": "!newData.exists() || ((!data.exists() && newData.hasChildren(['eventId','eventName'])) || (data.exists() && (!newData.child('eventId').exists() || newData.child('eventId').isString()) && (!newData.child('eventName').exists() || newData.child('eventName').isString()) && (!data.child('eventId').exists() || newData.child('eventId').isString()) && (!data.child('eventName').exists() || newData.child('eventName').isString())))",
          "slug": { ".validate": "newData.isString() || !newData.exists()" },
          "startAt": { ".validate": "newData.isString() || !newData.exists()" },
          "endAt": { ".validate": "newData.isString() || !newData.exists()" },          "faculties": {
            ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()",
            "$index": {
              ".validate": "!newData.exists() || (newData.hasChildren(['faculty']) && newData.child('faculty').isString() && (!newData.child('fallbackLabel').exists() || newData.child('fallbackLabel').isString()) && (!newData.child('departmentLabel').exists() || newData.child('departmentLabel').isString()) && (!newData.child('unitTree').exists() || (newData.child('unitTree').hasChildren(['label','options']) && newData.child('unitTree').child('label').isString())))",
              "faculty": { ".validate": "newData.isString()" },
              "fallbackLabel": { ".validate": "newData.isString() || !newData.exists()" },
              "departmentLabel": { ".validate": "newData.isString() || !newData.exists()" },
              "unitTree": {
                ".validate": "!newData.exists() || (newData.hasChildren(['label','options']) && newData.child('label').isString() && (!newData.child('placeholder').exists() || newData.child('placeholder').isString()) && (!newData.child('allowCustom').exists() || newData.child('allowCustom').isBoolean()))",
                "label": { ".validate": "newData.isString()" },
                "placeholder": { ".validate": "newData.isString() || !newData.exists()" },
                "allowCustom": { ".validate": "newData.isBoolean() || !newData.exists()" },
                "options": {
                  ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()",
                  "$optionIndex": {
                    ".validate": "!newData.exists() || (newData.hasChildren(['label','value']) && newData.child('label').isString() && newData.child('value').isString())",
                    "label": { ".validate": "newData.isString()" },
                    "value": { ".validate": "newData.isString()" },
                    "children": {
                      ".validate": "!newData.exists() || (newData.hasChildren(['label','options']) && newData.child('label').isString() && (!newData.child('placeholder').exists() || newData.child('placeholder').isString()) && (!newData.child('allowCustom').exists() || newData.child('allowCustom').isBoolean()))",
                      "label": { ".validate": "newData.isString()" },
                      "placeholder": { ".validate": "newData.isString() || !newData.exists()" },
                      "allowCustom": { ".validate": "newData.isBoolean() || !newData.exists()" },
                      "options": {
                        ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()",
                        "$childIndex": {
                          ".validate": "!newData.exists() || (newData.hasChildren(['label','value']) && newData.child('label').isString() && newData.child('value').isString())",
                          "label": { ".validate": "newData.isString()" },
                          "value": { ".validate": "newData.isString()" },
                          "children": {
                            ".validate": "!newData.exists() || (newData.hasChildren(['label','options']) && newData.child('label').isString())"
                          },
                          "$other": { ".validate": false }
                        }
                      },
                      "$other": { ".validate": false }
                    },
                    "$other": { ".validate": false }
                  }
                },
                "$other": { ".validate": false }
              },
              "$other": { ".validate": false }
            }
          },
          "teams": {
            ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()",
            "$teamIndex": { ".validate": "!newData.exists() || newData.isString()" }
          },
          "schedules": {
            ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()",
            "$index": {
              ".validate": "!newData.exists() || (newData.hasChildren(['id']) && newData.child('id').isString() && (!newData.child('label').exists() || newData.child('label').isString()) && (!newData.child('date').exists() || newData.child('date').isString()))",
              "id": { ".validate": "newData.isString()" },
              "label": { ".validate": "newData.isString() || !newData.exists()" },
              "date": { ".validate": "newData.isString() || !newData.exists()" },
              "$other": { ".validate": false }
            }
          },
          "guidance": { ".validate": "newData.isString() || !newData.exists()" },
          "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "createdAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "eventId": { ".validate": "newData.isString() || !newData.exists()" },
          "eventName": { ".validate": "newData.isString() || !newData.exists()" },
          "$other": { ".validate": false }
        }
      },
      "applications": {
        "$eventId": {
          ".read": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
          "$applicationId": {
            ".write": "(auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (auth == null && !data.exists())",
            ".validate": "newData.hasChildren(['name','email','faculty','department','shifts','eventId','eventName','slug','createdAt','updatedAt']) && newData.child('name').isString() && newData.child('email').isString() && newData.child('faculty').isString() && newData.child('department').isString() && newData.child('eventId').isString() && newData.child('eventName').isString() && newData.child('slug').isString() && (!newData.child('grade').exists() || newData.child('grade').isString()) && (!newData.child('phonetic').exists() || newData.child('phonetic').isString()) && (!newData.child('club').exists() || newData.child('club').isString()) && (!newData.child('studentId').exists() || newData.child('studentId').isString()) && (!newData.child('note').exists() || newData.child('note').isString()) && (!newData.child('academicPath').exists() || (!newData.child('academicPath').isString() && !newData.child('academicPath').isNumber() && !newData.child('academicPath').isBoolean())) && !newData.child('shifts').isString() && !newData.child('shifts').isNumber() && !newData.child('shifts').isBoolean() && (newData.child('createdAt').isNumber() || newData.child('createdAt').val() == now) && (newData.child('updatedAt').isNumber() || newData.child('updatedAt').val() == now)",
          "createdAt": { ".validate": "newData.isNumber() || newData.val() == now" },
          "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now" },
          "shifts": {
            ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()",
            "$scheduleId": { ".validate": "!newData.exists() || newData.isBoolean()" }
          },
          "academicPath": {
            ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()",
            "$index": {
              ".validate": "!newData.exists() || (newData.hasChildren(['label','value']) && newData.child('label').isString() && newData.child('value').isString() && (!newData.child('display').exists() || newData.child('display').isString()) && (!newData.child('isCustom').exists() || newData.child('isCustom').isBoolean()))",
              "label": { ".validate": "newData.isString()" },
              "value": { ".validate": "newData.isString()" },
              "display": { ".validate": "newData.isString() || !newData.exists()" },
              "isCustom": { ".validate": "newData.isBoolean() || !newData.exists()" },
              "$other": { ".validate": false }
            }
          },
          "$other": { ".validate": true }
        }
      }
      },
      "slugIndex": {
        "$slug": {
          ".read": true,
          ".write": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
          ".validate": "newData.isString() || !newData.exists()"
        }
      },
      "facultyCatalog": {
        ".read": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
        ".write": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
        ".validate": "!newData.exists() || newData.hasChildren(['faculties'])",
        "faculties": {
          ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()",
          "$index": {
            ".validate": "!newData.exists() || (newData.hasChildren(['faculty']) && newData.child('faculty').isString() && (!newData.child('fallbackLabel').exists() || newData.child('fallbackLabel').isString()) && (!newData.child('departmentLabel').exists() || newData.child('departmentLabel').isString()) && (!newData.child('unitTree').exists() || (newData.child('unitTree').hasChildren(['label','options']) && newData.child('unitTree').child('label').isString())))",
            "faculty": { ".validate": "newData.isString()" },
            "fallbackLabel": { ".validate": "newData.isString() || !newData.exists()" },
            "departmentLabel": { ".validate": "newData.isString() || !newData.exists()" },
            "unitTree": {
              ".validate": "!newData.exists() || (newData.hasChildren(['label','options']) && newData.child('label').isString() && (!newData.child('placeholder').exists() || newData.child('placeholder').isString()) && (!newData.child('allowCustom').exists() || newData.child('allowCustom').isBoolean()))",
              "label": { ".validate": "newData.isString()" },
              "placeholder": { ".validate": "newData.isString() || !newData.exists()" },
              "allowCustom": { ".validate": "newData.isBoolean() || !newData.exists()" },
              "options": {
                ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()",
                "$optionIndex": {
                  ".validate": "!newData.exists() || (newData.hasChildren(['label','value']) && newData.child('label').isString() && newData.child('value').isString())",
                  "label": { ".validate": "newData.isString()" },
                  "value": { ".validate": "newData.isString()" },
                  "children": {
                    ".validate": "!newData.exists() || (newData.hasChildren(['label','options']) && newData.child('label').isString() && (!newData.child('placeholder').exists() || newData.child('placeholder').isString()) && (!newData.child('allowCustom').exists() || newData.child('allowCustom').isBoolean()))",
                    "label": { ".validate": "newData.isString()" },
                    "placeholder": { ".validate": "newData.isString() || !newData.exists()" },
                    "allowCustom": { ".validate": "newData.isBoolean() || !newData.exists()" },
                    "options": {
                      ".validate": "!newData.isString() && !newData.isNumber() && !newData.isBoolean()",
                      "$childIndex": {
                        ".validate": "!newData.exists() || (newData.hasChildren(['label','value']) && newData.child('label').isString() && newData.child('value').isString())",
                        "label": { ".validate": "newData.isString()" },
                        "value": { ".validate": "newData.isString()" },
                        "children": {
                          ".validate": "!newData.exists() || (newData.hasChildren(['label','options']) && newData.child('label').isString())"
                        },
                        "$other": { ".validate": false }
                      }
                    },
                    "$other": { ".validate": false }
                  },
                  "$other": { ".validate": false }
                }
              },
              "$other": { ".validate": false }
            },
            "$other": { ".validate": false }
          }
        },
        "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
        "updatedByUid": { ".validate": "newData.isString() || !newData.exists()" },
        "updatedByName": { ".validate": "newData.isString() || !newData.exists()" },
        "$other": { ".validate": false }
      }
    },

    "glAssignments": {
      "$eventId": {
        ".read": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
        "$glId": {
          ".write": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
          ".validate": "!newData.exists() || (newData.hasChildren(['status','teamId','updatedAt']) && newData.child('status').isString() && newData.child('teamId').isString() && (newData.child('updatedAt').isNumber() || newData.child('updatedAt').val() == now) && (!newData.child('updatedByUid').exists() || newData.child('updatedByUid').isString()) && (!newData.child('updatedByName').exists() || newData.child('updatedByName').isString()))",
          "status": { ".validate": "newData.isString() || !newData.exists()" },
          "teamId": { ".validate": "newData.isString() || !newData.exists()" },
          "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "updatedByUid": { ".validate": "newData.isString() || !newData.exists()" },
          "updatedByName": { ".validate": "newData.isString() || !newData.exists()" },
          "$other": { ".validate": false }
        }
      }
    },

    "operatorPresence": {
      ".read": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
      "$eventId": {
        ".read": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
        "$sessionId": {
          ".read": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
          ".write": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true) && ((newData.exists() && newData.child('uid').val() == auth.uid) || (!newData.exists() && (!data.exists() || data.child('uid').val() == auth.uid)))",
          ".validate": "!newData.exists() || (newData.hasChildren(['uid','eventId']) && newData.child('uid').isString() && newData.child('uid').val() == auth.uid && newData.child('eventId').isString() && newData.child('eventId').val() == $eventId && (!newData.child('eventName').exists() || newData.child('eventName').isString()) && (!newData.child('scheduleId').exists() || newData.child('scheduleId').isString()) && (!newData.child('scheduleKey').exists() || newData.child('scheduleKey').isString()) && (!newData.child('scheduleLabel').exists() || newData.child('scheduleLabel').isString()) && (!newData.child('selectedScheduleId').exists() || newData.child('selectedScheduleId').isString()) && (!newData.child('selectedScheduleLabel').exists() || newData.child('selectedScheduleLabel').isString()) && (!newData.child('displayName').exists() || newData.child('displayName').isString()) && (!newData.child('email').exists() || newData.child('email').isString()) && (!newData.child('clientTimestamp').exists() || newData.child('clientTimestamp').isNumber()) && (!newData.child('updatedAt').exists() || newData.child('updatedAt').isNumber() || newData.child('updatedAt').val() == now) && (!newData.child('reason').exists() || newData.child('reason').isString()) && (!newData.child('sessionId').exists() || (newData.child('sessionId').isString() && newData.child('sessionId').val() == $sessionId)) && (!newData.child('skipTelop').exists() || newData.child('skipTelop').isBoolean()) && (!newData.child('source').exists() || newData.child('source').isString()))",
          "uid": { ".validate": "newData.isString() && newData.val() == auth.uid" },
          "eventId": { ".validate": "newData.isString() && newData.val() == $eventId" },
          "eventName": { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleId": { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleKey": { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleLabel": { ".validate": "newData.isString() || !newData.exists()" },
          "selectedScheduleId": { ".validate": "newData.isString() || !newData.exists()" },
          "selectedScheduleLabel": { ".validate": "newData.isString() || !newData.exists()" },
          "displayName": { ".validate": "newData.isString() || !newData.exists()" },
          "email": { ".validate": "newData.isString() || !newData.exists()" },
          "clientTimestamp": { ".validate": "newData.isNumber() || !newData.exists()" },
          "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "reason": { ".validate": "newData.isString() || !newData.exists()" },
          "sessionId": { ".validate": "newData.isString() && newData.val() == $sessionId" },
          "skipTelop": { ".validate": "newData.isBoolean() || !newData.exists()" },
          "source": { ".validate": "newData.isString() || !newData.exists()" },
          "$other": { ".validate": false }
        }
      }
    },

    "operatorPresenceConsensus": {
      ".read": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
      "$eventId": {
        ".read": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
        ".write": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
        ".validate": "!newData.exists() || (newData.hasChildren(['conflictSignature']) && newData.child('conflictSignature').isString() && newData.child('conflictSignature').val().length > 0 && (!newData.child('scheduleKey').exists() || newData.child('scheduleKey').isString()) && (!newData.child('scheduleId').exists() || newData.child('scheduleId').isString()) && (!newData.child('scheduleLabel').exists() || newData.child('scheduleLabel').isString()) && (!newData.child('scheduleRange').exists() || newData.child('scheduleRange').isString()) && (!newData.child('status').exists() || (newData.child('status').isString() && newData.child('status').val().matches(/^(pending|resolved)$/))) && (!newData.child('requestedByUid').exists() || newData.child('requestedByUid').isString()) && (!newData.child('requestedByDisplayName').exists() || newData.child('requestedByDisplayName').isString()) && (!newData.child('requestedBySessionId').exists() || newData.child('requestedBySessionId').isString()) && (!newData.child('requestedAt').exists() || newData.child('requestedAt').isNumber() || newData.child('requestedAt').val() == now) && (!newData.child('resolvedByUid').exists() || newData.child('resolvedByUid').isString()) && (!newData.child('resolvedByDisplayName').exists() || newData.child('resolvedByDisplayName').isString()) && (!newData.child('resolvedBySessionId').exists() || newData.child('resolvedBySessionId').isString()) && (!newData.child('resolvedAt').exists() || newData.child('resolvedAt').isNumber() || newData.child('resolvedAt').val() == now) && (!newData.child('updatedAt').exists() || newData.child('updatedAt').isNumber() || newData.child('updatedAt').val() == now))",
        "conflictSignature": { ".validate": "newData.isString() && newData.val().length > 0" },
        "scheduleKey": { ".validate": "newData.isString() || !newData.exists()" },
        "scheduleId": { ".validate": "newData.isString() || !newData.exists()" },
        "scheduleLabel": { ".validate": "newData.isString() || !newData.exists()" },
        "scheduleRange": { ".validate": "newData.isString() || !newData.exists()" },
        "status": { ".validate": "(!newData.exists()) || (newData.isString() && newData.val().matches(/^(pending|resolved)$/))" },
        "requestedByUid": { ".validate": "newData.isString() || !newData.exists()" },
        "requestedByDisplayName": { ".validate": "newData.isString() || !newData.exists()" },
        "requestedBySessionId": { ".validate": "newData.isString() || !newData.exists()" },
        "requestedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
        "resolvedByUid": { ".validate": "newData.isString() || !newData.exists()" },
        "resolvedByDisplayName": { ".validate": "newData.isString() || !newData.exists()" },
        "resolvedBySessionId": { ".validate": "newData.isString() || !newData.exists()" },
        "resolvedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
        "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
        "$other": { ".validate": false }
      }
    },

    "questions": {
      ".read": "auth != null",
      "normal": {
        "$uid": {
          ".write": "(auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (auth == null && !data.exists() && newData.child('uid').isString() && newData.child('uid').val() == $uid && newData.child('token').isString() && newData.child('token').val().length > 0 && root.child('questionIntake/tokens').child(newData.child('token').val()).exists() && root.child('questionIntake/tokens').child(newData.child('token').val()).child('revoked').val() != true && (!root.child('questionIntake/tokens').child(newData.child('token').val()).child('expiresAt').exists() || root.child('questionIntake/tokens').child(newData.child('token').val()).child('expiresAt').val() >= now) && newData.child('participantId').isString() && newData.child('participantId').val() == root.child('questionIntake/tokens').child(newData.child('token').val()).child('participantId').val() && (!newData.child('eventId').exists() || newData.child('eventId').val() == root.child('questionIntake/tokens').child(newData.child('token').val()).child('eventId').val()) && (!newData.child('scheduleId').exists() || newData.child('scheduleId').val() == root.child('questionIntake/tokens').child(newData.child('token').val()).child('scheduleId').val()) && newData.child('type').isString() && newData.child('type').val() == 'normal')",
          ".validate": "newData.hasChildren(['uid','name','question'])",
          "uid":       { ".validate": "newData.isString()" },
          "token":     { ".validate": "newData.isString() || !newData.exists()" },
          "name":      { ".validate": "newData.isString()" },
          "question":  { ".validate": "newData.isString()" },
          "group":     { ".validate": "newData.isString() || !newData.exists()" },
          "genre":     { ".validate": "newData.isString() || !newData.exists()" },
          "schedule":  { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleStart": { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleEnd":   { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleDate":  { ".validate": "newData.isString() || !newData.exists()" },
          "participantId": { ".validate": "newData.isString() || !newData.exists()" },
          "participantName": { ".validate": "newData.isString() || !newData.exists()" },
          "guidance": { ".validate": "newData.isString() || !newData.exists()" },
          "eventId":   { ".validate": "newData.isString() || !newData.exists()" },
          "eventName": { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleId":{ ".validate": "newData.isString() || !newData.exists()" },
          "ts":        { ".validate": "newData.isNumber() || !newData.exists()" },
          "updatedAt": { ".validate": "newData.isNumber()  || !newData.exists()" },
          "type":      { ".validate": "newData.isString() || !newData.exists()" },
          "questionLength": { ".validate": "newData.isNumber() || !newData.exists()" },
          "$other":    { ".validate": false }
        }
      },
      "pickup": {
        "$uid": {
          ".write": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
          ".validate": "newData.hasChildren(['uid','name','question'])"
        }
      }
    },

    "questionStatus": {
      ".read": "auth != null",
      "$uid": {
        ".write": "(auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (auth == null && !data.exists() && newData.hasChildren(['answered','selecting']) && newData.child('answered').isBoolean() && newData.child('answered').val() == false && newData.child('selecting').isBoolean() && newData.child('selecting').val() == false && (!newData.child('updatedAt').exists() || newData.child('updatedAt').isNumber()) && root.child('questions/normal').child($uid).exists())",
        "answered": { ".validate": "newData.isBoolean() || !newData.exists()" },
        "selecting": { ".validate": "newData.isBoolean() || !newData.exists()" },
        "updatedAt": { ".validate": "newData.isNumber() || !newData.exists()" },
        "$other": { ".validate": false }
      }
    },

    "dictionary": {
      ".read": true,
      ".write": "auth != null && root.child('admins').child(auth.uid).val() == true"
    },

    "logs": {
      ".read": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
      ".write": "auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)",
      "history": {
        ".indexOn": ["timestamp"],
        "$logId": {
          ".validate": "!newData.exists() || (newData.hasChildren(['timestamp','User','Action','Details']) && newData.child('timestamp').isNumber() && newData.child('User').isString() && newData.child('Action').isString() && newData.child('Details').isString() && (!newData.child('UserId').exists() || newData.child('UserId').isString()) && (!newData.child('Level').exists() || newData.child('Level').isString()) && (!newData.child('Timestamp').exists() || newData.child('Timestamp').isString()) && (!newData.child('createdAt').exists() || newData.child('createdAt').isNumber() || newData.child('createdAt').val() == now) && (!newData.child('updatedAt').exists() || newData.child('updatedAt').isNumber() || newData.child('updatedAt').val() == now))",
          "timestamp": { ".validate": "newData.isNumber()" },
          "User": { ".validate": "newData.isString()" },
          "Action": { ".validate": "newData.isString()" },
          "Details": { ".validate": "newData.isString()" },
          "UserId": { ".validate": "newData.isString() || !newData.exists()" },
          "Level": { ".validate": "newData.isString() || !newData.exists()" },
          "Timestamp": { ".validate": "newData.isString() || !newData.exists()" },
          "createdAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "$other": { ".validate": false }
        }
      }
    },

    "questionIntake": {
      ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
      ".write": "auth != null && root.child('admins').child(auth.uid).val() == true",
      "events": {
        ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
        "$eventId": {
          ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
          ".write": "auth != null && root.child('admins').child(auth.uid).val() == true",
          ".validate": "!newData.exists() || (newData.hasChildren(['name']) && newData.child('name').isString())",
          "name": { ".validate": "newData.isString()" },
          "createdAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "$other": { ".validate": false }
        }
      },
      "schedules": {
        ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
        "$eventId": {
          ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
          "$scheduleId": {
            ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
            ".write": "auth != null && root.child('admins').child(auth.uid).val() == true",
            ".validate": "!newData.exists() || (newData.hasChildren(['label']) && newData.child('label').isString())",
            "label": { ".validate": "newData.isString()" },
            "date": { ".validate": "newData.isString() || !newData.exists()" },
            "startAt": { ".validate": "newData.isString() || !newData.exists()" },
            "endAt": { ".validate": "newData.isString() || !newData.exists()" },
            "participantCount": { ".validate": "newData.isNumber() || !newData.exists()" },
            "createdAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
            "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
            "$other": { ".validate": false }
          }
        }
      },
      "participants": {
        ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
        "$eventId": {
          ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
          "$scheduleId": {
            ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
            "$participantId": {
              ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
              ".write": "auth != null && root.child('admins').child(auth.uid).val() == true",
              ".validate": "!newData.exists() || (newData.hasChildren(['participantId','name','groupNumber','token']) && newData.child('participantId').isString() && newData.child('name').isString() && newData.child('groupNumber').isString() && newData.child('token').isString())",
              "participantId": { ".validate": "newData.isString()" },
              "uid": { ".validate": "newData.isString() || !newData.exists()" },
              "legacyParticipantId": { ".validate": "newData.isString() || !newData.exists()" },
              "name": { ".validate": "newData.isString()" },
              "phonetic": { ".validate": "newData.isString() || !newData.exists()" },
              "furigana": { ".validate": "newData.isString() || !newData.exists()" },
              "gender": { ".validate": "newData.isString() || !newData.exists()" },
              "department": { ".validate": "newData.isString() || !newData.exists()" },
              "phone": { ".validate": "newData.isString() || !newData.exists()" },
              "email": { ".validate": "newData.isString() || !newData.exists()" },
              "groupNumber": { ".validate": "newData.isString()" },
              "teamNumber": { ".validate": "newData.isString() || !newData.exists()" },
              "token": { ".validate": "newData.isString()" },
              "guidance": { ".validate": "newData.isString() || !newData.exists()" },
              "status": { ".validate": "newData.isString() || !newData.exists()" },
              "isCancelled": { ".validate": "newData.isBoolean() || !newData.exists()" },
              "isRelocated": { ".validate": "newData.isBoolean() || !newData.exists()" },
              "relocationSourceScheduleId": { ".validate": "newData.isString() || !newData.exists()" },
              "relocationSourceScheduleLabel": { ".validate": "newData.isString() || !newData.exists()" },
              "relocationDestinationScheduleId": { ".validate": "newData.isString() || !newData.exists()" },
              "relocationDestinationScheduleLabel": { ".validate": "newData.isString() || !newData.exists()" },
              "relocationDestinationTeamNumber": { ".validate": "newData.isString() || !newData.exists()" },
              "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
              "$other": { ".validate": false }
            }
          }
        }
      },
      "tokens": {
        "$token": {
          ".read": true,
          ".write": "auth != null && root.child('admins').child(auth.uid).val() == true",
          ".validate": "!newData.exists() || (newData.hasChildren(['eventId','scheduleId','participantId','displayName','groupNumber']) && newData.child('eventId').isString() && newData.child('scheduleId').isString() && newData.child('participantId').isString() && newData.child('displayName').isString() && newData.child('groupNumber').isString())",
          "eventId": { ".validate": "newData.isString()" },
          "eventName": { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleId": { ".validate": "newData.isString()" },
          "scheduleLabel": { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleDate": { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleStart": { ".validate": "newData.isString() || !newData.exists()" },
          "scheduleEnd": { ".validate": "newData.isString() || !newData.exists()" },
          "participantId": { ".validate": "newData.isString()" },
          "participantUid": { ".validate": "newData.isString() || !newData.exists()" },
          "displayName": { ".validate": "newData.isString()" },
          "groupNumber": { ".validate": "newData.isString()" },
          "teamNumber": { ".validate": "newData.isString() || !newData.exists()" },
          "guidance": { ".validate": "newData.isString() || !newData.exists()" },
          "expiresAt": { ".validate": "newData.isNumber() || !newData.exists()" },
          "updatedAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "createdAt": { ".validate": "newData.isNumber() || newData.val() == now || !newData.exists()" },
          "revoked": { ".validate": "newData.isBoolean() || !newData.exists()" },
          "$other": { ".validate": false }
        }
      },
      "submissions": {
        "$token": {
          ".read": false,
          ".write": "(auth == null && root.child('questionIntake/tokens').child($token).exists() && root.child('questionIntake/tokens').child($token).child('revoked').val() != true && (!root.child('questionIntake/tokens').child($token).child('expiresAt').exists() || root.child('questionIntake/tokens').child($token).child('expiresAt').val() >= now)) || (auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true))",
          "$submissionId": {
            ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.hasChildren(['radioName','question','questionLength','genre','eventId','scheduleId','participantId','formVersion','submittedAt']))",
            "radioName": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.isString() && newData.val().length > 0)" },
            "question": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.isString() && newData.val().length > 0)" },
            "questionLength": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.isNumber() && newData.val() > 0)" },
            "genre": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.isString() && newData.val().length > 0)" },
            "eventId": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.isString() && newData.val() == root.child('questionIntake/tokens').child($token).child('eventId').val())" },
            "scheduleId": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.isString() && newData.val() == root.child('questionIntake/tokens').child($token).child('scheduleId').val())" },
            "participantId": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.isString() && newData.val() == root.child('questionIntake/tokens').child($token).child('participantId').val())" },
            "formVersion": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.isString())" },
            "submittedAt": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && (newData.isNumber() || newData.val() == now))" },
            "groupNumber": { ".validate": "newData.isString() || !newData.exists()" },
            "scheduleLabel": { ".validate": "newData.isString() || !newData.exists()" },
            "scheduleDate": { ".validate": "newData.isString() || !newData.exists()" },
            "scheduleStart": { ".validate": "newData.isString() || !newData.exists()" },
            "scheduleEnd": { ".validate": "newData.isString() || !newData.exists()" },
            "eventName": { ".validate": "newData.isString() || !newData.exists()" },
            "participantName": { ".validate": "newData.isString() || !newData.exists()" },
            "guidance": { ".validate": "newData.isString() || !newData.exists()" },
            "language": { ".validate": "newData.isString() || !newData.exists()" },
            "userAgent": { ".validate": "newData.isString() || !newData.exists()" },
            "referrer": { ".validate": "newData.isString() || !newData.exists()" },
            "origin": { ".validate": "newData.isString() || !newData.exists()" },
            "clientTimestamp": { ".validate": "newData.isNumber() || !newData.exists()" },
            "status": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.isString() && newData.val() == 'pending')" },
            "token": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && (!newData.exists() || newData.val() == $token))" },
            "uid": { ".validate": "(!newData.exists() && auth != null && (root.child('admins').child(auth.uid).val() == true || auth.token.admin == true)) || (!data.exists() && newData.isString())" },
            "$other": { ".validate": false }
          }
        }
      },
      "submissionErrors": {
        ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
        ".write": "auth != null && root.child('admins').child(auth.uid).val() == true"
      }
    },

    "signals": {
      ".read": true,
      "$signal": {
        ".write": "auth != null"
      }
    },

    "admins": {
      ".read": false,
      ".write": "auth != null && root.child('admins').child(auth.uid).val() == true"
    },

    "screens": {
      "approved": {
        "$uid": {
          ".read": "auth != null && auth.token.firebase.sign_in_provider === 'anonymous' && auth.uid === $uid",
          ".write": false
        }
      },
      "sessions": {
        "$uid": {
          ".read": "auth != null && root.child('admins').child(auth.uid).val() == true",
          ".write": false
        }
      }
    }
  }
}
