<?
  var bodyCtx = typeof context !== 'undefined' && context ? context : {};
  var bodySubjectEventNameMatch = bodyCtx.subject ? String(bodyCtx.subject).match(/【([^】]+)】/) : null;
  var bodySubjectEventName = bodySubjectEventNameMatch ? bodySubjectEventNameMatch[1].trim() : '';
  var eventName =
    bodyCtx.resolvedEventName ||
    bodyCtx.eventName ||
    bodyCtx.eventLabel ||
    bodyCtx.eventId ||
    bodySubjectEventName ||
    'イベント';
  var participantName = bodyCtx.participantName || '';
  var primaryScheduleLabel =
    bodyCtx.scheduleDateDisplay ||
    bodyCtx.scheduleRangeLabel ||
    bodyCtx.scheduleLabel ||
    '';
  var secondaryScheduleLabel = '';
  if (bodyCtx.scheduleDateDisplay && bodyCtx.scheduleTimeDisplay) {
    secondaryScheduleLabel = bodyCtx.scheduleTimeDisplay;
  } else if (!bodyCtx.scheduleDateDisplay && bodyCtx.scheduleTimeDisplay) {
    secondaryScheduleLabel = bodyCtx.scheduleTimeDisplay;
  } else if (!bodyCtx.scheduleDateDisplay && !bodyCtx.scheduleTimeDisplay) {
    secondaryScheduleLabel = '';
  } else if (!bodyCtx.scheduleTimeDisplay && bodyCtx.scheduleRangeLabel && bodyCtx.scheduleRangeLabel !== primaryScheduleLabel) {
    secondaryScheduleLabel = bodyCtx.scheduleRangeLabel;
  }
  var contactUrl = bodyCtx.contactLinkUrl || (bodyCtx.contactEmail ? 'mailto:' + bodyCtx.contactEmail : '');
  var contactLabel = bodyCtx.contactLinkLabel || (bodyCtx.contactEmail ? 'お問い合わせする' : '');
  var closingMessage = bodyCtx.closingMessage || 'それでは、みなさんに会えるのをお待ちしています！';
  var signaturePrimary = bodyCtx.signaturePrimary || bodyCtx.senderName || '弘前大学生協学生委員会';
  var signatureSecondary = bodyCtx.signatureSecondary || (eventName ? eventName + '運営チーム' : '運営チーム');
?>
<div class="mail-container">
  <? if (bodyCtx.mode !== 'web' && bodyCtx.webViewUrl) { ?>
    <div class="mail-browser-link"><a href="<?= bodyCtx.webViewUrl ?>" target="_blank" rel="noopener">ブラウザで表示する</a></div>
  <? } ?>
  <div class="mail-card">
    <p class="mail-header"><?= eventName ?>参加日時の確認</p>
    <? if (participantName) { ?>
      <p class="mail-info mail-info--greeting">こんにちは！ <?= participantName ?> 様</p>
    <? } ?>
    <p class="mail-info">今回は<strong>「<?= eventName ?>」</strong>にご参加いただきありがとうございます！</p>
    <p class="mail-info"><strong><?= participantName ? participantName + ' 様の' : '' ?>参加日は以下の通りです：</strong></p>
    <? if (primaryScheduleLabel || secondaryScheduleLabel) { ?>
      <div class="mail-date-box">
        <? if (primaryScheduleLabel) { ?>
          <span><?= primaryScheduleLabel ?></span>
        <? } ?>
        <? if (secondaryScheduleLabel) { ?>
          <span class="mail-date-box__secondary"><?= secondaryScheduleLabel ?></span>
        <? } ?>
      </div>
    <? } ?>
    <? if (bodyCtx.location || bodyCtx.arrivalNote) { ?>
      <p class="mail-info">
        当日は<? if (bodyCtx.location) { ?><strong><?= bodyCtx.location ?></strong><? } else { ?>会場にて<? } ?>開催します。
        <? if (bodyCtx.arrivalNote) { ?><br><strong><?= bodyCtx.arrivalNote ?></strong><? } ?>
      </p>
    <? } ?>
    <hr class="mail-divider">
    <p class="mail-info">
      受付の際に本人確認のため、<strong>本メール画面</strong>を見せていただく場合がございます。<br>
      あらかじめ<strong>スクリーンショットのご用意</strong>をお願いします。
    </p>
    <? if (bodyCtx.guidance) { ?>
      <hr class="mail-divider">
      <p class="mail-info"><?= bodyCtx.guidance ?></p>
    <? } ?>
    <? if (bodyCtx.additionalHtml || bodyCtx.additionalText) { ?>
      <hr class="mail-divider">
      <? if (bodyCtx.additionalHtml) { ?>
        <div class="mail-info"><?!= bodyCtx.additionalHtml ?></div>
      <? } ?>
      <? if (bodyCtx.additionalText) { ?>
        <p class="mail-info"><?= bodyCtx.additionalText ?></p>
      <? } ?>
    <? } ?>
    <? if ((contactUrl && contactLabel) || bodyCtx.contactEmail) { ?>
      <hr class="mail-divider">
      <p class="mail-info">
        事情があって会に参加できなくなった場合や、質問がある場合は、下のボタンからお問い合わせください。
      </p>
      <? if (contactUrl && contactLabel) { ?>
        <p class="mail-cta">
          <a href="<?= contactUrl ?>" class="mail-button" target="_blank" rel="noopener"><?= contactLabel ?></a>
        </p>
      <? } ?>
      <? if (bodyCtx.contactEmail) { ?>
        <p class="mail-info mail-info--muted">メール: <a href="mailto:<?= bodyCtx.contactEmail ?>"><?= bodyCtx.contactEmail ?></a></p>
      <? } ?>
    <? } ?>
    <? if (bodyCtx.footerNote) { ?>
      <hr class="mail-divider">
      <p class="mail-info"><?= bodyCtx.footerNote ?></p>
    <? } ?>
    <p class="mail-footer"><?= closingMessage ?></p>
    <p class="mail-footer">
      <?= signaturePrimary ?><br>
      <?= signatureSecondary ?>
    </p>
  </div>
</div>
