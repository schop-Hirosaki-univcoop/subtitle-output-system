<?
  const ctx = this.context || {};
  const eventName = ctx.eventName || ctx.eventId || 'イベント';
  const highlightLabel = ctx.scheduleRangeLabel || ctx.scheduleLabel || '';
  const highlightDate = ctx.scheduleDateDisplay || '';
  const highlightTime = ctx.scheduleTimeDisplay || '';
  const fallbackHighlight = !highlightDate && !highlightTime ? highlightLabel : '';
  const contactUrl = ctx.contactLinkUrl || '';
  const contactLabel = ctx.contactLinkLabel || '';
?>
<div class="mail-container">
  <? if (ctx.mode !== 'web' && ctx.webViewUrl) { ?>
    <div class="mail-browser-link"><a href="<?= ctx.webViewUrl ?>" target="_blank" rel="noopener">ブラウザで表示する</a></div>
  <? } ?>
  <div class="mail-card">
    <header class="mail-header">
      <? if (ctx.tagline) { ?>
        <p class="mail-header__tagline"><?= ctx.tagline ?></p>
      <? } ?>
      <h1 class="mail-header__title"><?= eventName ?> ご参加案内</h1>
      <? if (highlightLabel && (highlightDate || highlightTime)) { ?>
        <p class="mail-header__subtitle"><?= highlightLabel ?></p>
      <? } else if (highlightLabel) { ?>
        <p class="mail-header__subtitle"><?= highlightLabel ?></p>
      <? } ?>
    </header>

    <section class="mail-section mail-section--intro">
      <? if (ctx.participantName) { ?>
        <p class="mail-greeting"><?= ctx.participantName ?> 様</p>
      <? } ?>
      <p class="mail-intro">このたびは「<?= eventName ?>」へお申し込みいただきありがとうございます。以下の内容をご確認ください。</p>
    </section>

    <? if (highlightLabel || highlightDate || highlightTime || ctx.arrivalNote) { ?>
      <section class="mail-section mail-section--highlight">
        <h2 class="mail-section__title">ご参加日時</h2>
        <div class="mail-highlight">
          <? if (highlightDate) { ?>
            <p class="mail-highlight__date"><?= highlightDate ?></p>
          <? } ?>
          <? if (highlightTime) { ?>
            <p class="mail-highlight__time"><?= highlightTime ?></p>
          <? } ?>
          <? if (fallbackHighlight) { ?>
            <p class="mail-highlight__label"><?= fallbackHighlight ?></p>
          <? } ?>
        </div>
        <? if (ctx.arrivalNote) { ?>
          <p class="mail-section__note"><?= ctx.arrivalNote ?></p>
        <? } ?>
      </section>
    <? } ?>

    <? if (ctx.location) { ?>
      <section class="mail-section mail-section--location">
        <h2 class="mail-section__title">会場</h2>
        <p class="mail-section__text"><?= ctx.location ?></p>
      </section>
    <? } ?>

    <? if (ctx.guidance) { ?>
      <section class="mail-section mail-section--guidance">
        <h2 class="mail-section__title">当日の流れ</h2>
        <p class="mail-section__text"><?= ctx.guidance ?></p>
      </section>
    <? } ?>

    <? if (ctx.additionalHtml || ctx.additionalText) { ?>
      <section class="mail-section mail-section--additional">
        <h2 class="mail-section__title">補足情報</h2>
        <? if (ctx.additionalHtml) { ?>
          <div class="mail-section__text"><?!= ctx.additionalHtml ?></div>
        <? } ?>
        <? if (ctx.additionalText) { ?>
          <p class="mail-section__text"><?= ctx.additionalText ?></p>
        <? } ?>
      </section>
    <? } ?>

    <? if ((contactUrl && contactLabel) || ctx.contactEmail) { ?>
      <section class="mail-section mail-section--cta">
        <h2 class="mail-section__title">お問い合わせ</h2>
        <? if (contactUrl && contactLabel) { ?>
          <p class="mail-section__cta">
            <a href="<?= contactUrl ?>" class="mail-button" target="_blank" rel="noopener"><?= contactLabel ?></a>
          </p>
        <? } ?>
        <? if (ctx.contactEmail) { ?>
          <p class="mail-section__text mail-section__text--muted">メール: <a href="mailto:<?= ctx.contactEmail ?>"><?= ctx.contactEmail ?></a></p>
        <? } ?>
      </section>
    <? } ?>

    <? if (ctx.footerNote) { ?>
      <section class="mail-section mail-section--footer-note">
        <p class="mail-section__text"><?= ctx.footerNote ?></p>
      </section>
    <? } ?>

    <footer class="mail-footer">
      <p class="mail-footer__signature"><?= ctx.senderName || 'イベント運営チーム' ?></p>
    </footer>
  </div>
</div>

<? if (ctx.mode === 'web' && ctx.webViewUrl) { ?>
  <p class="mail-web-note">このページのURLは参加者向けメールにも記載されています。共有の際はリンクの取り扱いにご注意ください。</p>
<? } ?>
