<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Telop Operator</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20viewBox%3D%270%200%2064%2064%27%3E%0A%20%20%3Crect%20width%3D%2764%27%20height%3D%2764%27%20rx%3D%2712%27%20fill%3D%27%2305111f%27%2F%3E%0A%20%20%3Ctext%20x%3D%2732%27%20y%3D%2742%27%20text-anchor%3D%27middle%27%20font-family%3D%27Arial%2C%20sans-serif%27%20font-size%3D%2736%27%20fill%3D%27%2300eaff%27%3ET%3C%2Ftext%3E%0A%3C%2Fsvg%3E">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script type="module" src="./scripts/shared/layout.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
</head>
<body class="op-theme dictionary-collapsed logs-collapsed">
    <!-- ローディングオーバーレイ -->
    <div id="loading-overlay" aria-live="polite" hidden>
      <div class="loading-backdrop"></div>
      <div class="loading-panel" role="status" aria-label="読み込み中">
        <div class="spinner" aria-hidden="true"></div>
        <div class="loading-text"><span id="loading-text">サインイン中…</span></div>
        <div class="loading-sub">数秒かかる場合があります</div>
        <!-- ★ 初期化の段階ステップ -->
        <ol id="loader-steps" class="loader-steps" aria-label="初期化ステップ"></ol>
      </div>
    </div>
  <telop-header tagline="Broadcast Subtitle Console" context-label="システム情報" actions-role="group" actions-label="補助パネル">
    <button slot="actions" id="logs-toggle" class="btn btn-ghost btn-icon" type="button" aria-expanded="false" aria-controls="logs-panel" aria-label="操作ログを開く" title="操作ログ">
      <span class="icon icon-menu" aria-hidden="true">
        <svg viewBox="0 0 24 24" role="img" focusable="false"><path d="M4 6.75A.75.75 0 0 1 4.75 6h14.5a.75.75 0 0 1 0 1.5H4.75A.75.75 0 0 1 4 6.75Zm0 5.25a.75.75 0 0 1 .75-.75h14.5a.75.75 0 0 1 0 1.5H4.75A.75.75 0 0 1 4 12Zm.75 4.5a.75.75 0 0 0 0 1.5h14.5a.75.75 0 0 0 0-1.5H4.75Z"/></svg>
      </span>
      <span class="btn-label">ログ</span>
    </button>
    <button slot="actions" id="dictionary-toggle" class="btn btn-ghost btn-icon" type="button" aria-expanded="false" aria-controls="dictionary-panel" aria-label="ルビ辞書管理を開く" title="ルビ辞書管理">
      <span class="icon icon-book" aria-hidden="true">
        <svg viewBox="0 0 24 24" role="img" focusable="false"><path d="M6.25 4C5.01 4 4 5.01 4 6.25v11.5C4 19.99 5.01 21 6.25 21H18a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H6.25Zm.25 2h11v12H6.25a.25.25 0 0 1-.25-.25V6.25c0-.138.112-.25.25-.25ZM8 8.25A.75.75 0 0 1 8.75 7.5h6.5a.75.75 0 0 1 0 1.5h-6.5A.75.75 0 0 1 8 8.25ZM8.75 11a.75.75 0 0 0 0 1.5h3.5a.75.75 0 0 0 0-1.5h-3.5Z"/></svg>
      </span>
      <span class="btn-label">辞書</span>
    </button>
    <div slot="meta" id="user-info" class="user-info"></div>
  </telop-header>

    <main id="main-container" class="layout-grid" style="display: none;">
        <section class="module module--primary" id="questions-panel" aria-labelledby="questions-title">
            <div class="module-header">
                <div class="module-heading">
                    <h1 id="questions-title">テロップ操作パネル</h1>
                    <p class="module-description">質問の選択・送出とログ監視を一つの画面で行えます。</p>
                </div>
                <div class="status-bar" role="group" aria-label="送出状況">
                    <div class="render-indicator" title="OnAir 状態">
                        <span id="render-lamp" class="lamp" aria-hidden="true"></span>
                        <span id="render-phase" class="lamp-label">-</span>
                    </div>
                    <div class="render-summary" id="render-summary">
                        <div class="render-line">
                            <span class="label">オンエア:</span>
                            <span id="render-title" class="text-strong">—</span>
                        </div>
                        <div id="render-question" class="text-soft">—</div>
                        <div id="render-updated" class="text-meta">—</div>
                    </div>
                </div>
            </div>
            <div class="module-body" id="questions-content">
                <div class="cards-sticky">
                    <div id="genre-tab-buttons" class="genre-tabs" role="tablist" aria-label="ジャンル">
                        <button class="genre-tab-button active" data-genre="学び" role="tab" aria-selected="true">学び</button>
                        <button class="genre-tab-button" data-genre="活動" role="tab" aria-selected="false">活動</button>
                        <button class="genre-tab-button" data-genre="暮らし" role="tab" aria-selected="false">暮らし</button>
                        <button class="genre-tab-button" data-genre="食・スポット" role="tab" aria-selected="false">食・スポット</button>
                        <button class="genre-tab-button" data-genre="移動・季節" role="tab" aria-selected="false">移動・季節</button>
                        <button class="genre-tab-button" data-genre="その他" role="tab" aria-selected="false">その他</button>
                    </div>
                    <div id="sub-tab-buttons" class="sub-tabs" role="tablist" aria-label="質問種別">
                        <button class="sub-tab-button active" data-sub-tab="all" role="tab" aria-selected="true">すべて</button>
                        <button class="sub-tab-button" data-sub-tab="normal" role="tab" aria-selected="false">通常質問</button>
                        <button class="sub-tab-button" data-sub-tab="puq" role="tab" aria-selected="false">Pick Up Question</button>
                    </div>
                    <div class="cards-toolbar">
                        <div class="toolbar-left">
                            <div class="schedule-context" aria-live="polite">
                                <div id="schedule-event-name" class="schedule-event" role="text">—</div>
                                <div class="schedule-meta">
                                    <span id="schedule-label" class="schedule-label">—</span>
                                    <span id="schedule-time-range" class="schedule-range" hidden></span>
                                </div>
                            </div>
                            <a id="operator-open-schedule-hub" class="btn btn-ghost btn-sm" href="#" hidden target="_blank" rel="noreferrer noopener">日程コントロールハブ</a>
                        </div>
                        <div class="toolbar-right">
                            <label class="chk">
                                <input id="select-all-checkbox" type="checkbox" />
                                全選択
                            </label>
                        </div>
                    </div>
                </div>
                <div class="cards-scroll">
                    <div id="questions-cards" class="cards-list" aria-live="polite"></div>
                </div>
            </div>
        </section>
        <aside class="module module--secondary" id="dictionary-panel" aria-labelledby="dictionary-title" hidden>
            <div class="module-header">
                <div class="module-heading">
                    <h2 id="dictionary-title">ルビ辞書管理</h2>
                    <p class="module-description">登録語句の追加や更新が即座にディスプレイへ反映されます。</p>
                </div>
                <div class="module-actions">
                    <button id="fetch-dictionary-button" class="btn btn-ghost" type="button">辞書を更新</button>
                </div>
            </div>
            <div class="module-body dictionary-body">
                <form id="add-term-form" class="dictionary-form">
                    <input type="text" id="new-term" class="input" placeholder="単語" required>
                    <input type="text" id="new-ruby" class="input" placeholder="ルビ" required>
                    <button type="submit" class="btn btn-primary">追加</button>
                </form>
                <div class="table-scroller">
                    <table id="dictionary-table">
                        <thead>
                            <tr><th>単語</th><th>ルビ</th><th>状態</th><th>操作</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </aside>
        <aside class="module module--secondary" id="logs-panel" aria-labelledby="logs-title" hidden>
            <div class="module-header">
                <div class="module-heading">
                    <h2 id="logs-title">操作ログ</h2>
                    <p class="module-description">直近の操作履歴を確認し、異常を素早く検知できます。</p>
                </div>
                <div class="module-actions">
                    <button id="logs-refresh-button" class="btn btn-ghost" type="button">ログを更新</button>
                </div>
            </div>
            <div class="module-body logs-body">
                <div id="logs-toolbar" class="logs-toolbar">
                  <input id="log-search" class="input" placeholder="検索 (user/action/details)">
                  <label class="chk"><input type="checkbox" id="log-autoscroll" checked> 自動スクロール</label>
                </div>
                <div id="logs-stream-view">
                  <div id="log-stream" class="log-stream"></div>
                </div>
            </div>
        </aside>
    </main>

    <div id="action-panel" style="display: none;">
        <button id="btn-display" class="btn btn-primary" disabled>送出</button>
        <button id="btn-unanswer" class="btn" disabled>未回答へ戻す</button>
        <button id="btn-edit" class="btn" disabled>原稿修正</button>
        <button id="btn-clear" class="btn btn-danger">送出クリア</button>
        <span id="selected-info">行を選択してください</span>
        <div class="action-panel-right">
          <button id="btn-batch-unanswer" class="btn btn-ghost" style="display: none;">選択項目を未回答へ戻す</button>
        </div>
    </div>

    <div id="edit-dialog" class="modal" role="dialog" aria-modal="true" aria-labelledby="edit-dialog-title" hidden>
      <div class="modal-backdrop" data-dialog-dismiss="true"></div>
      <div class="modal-panel">
        <div class="modal-header">
          <h2 id="edit-dialog-title">質問原稿の編集</h2>
        </div>
        <div class="modal-body">
          <div class="modal-field">
            <label for="edit-textarea">質問内容</label>
            <textarea id="edit-textarea" class="input" rows="8" data-autofocus></textarea>
          </div>
          <p class="modal-helper">送出前に内容を整えてください。更新するとディスプレイにも即座に反映されます。</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-ghost" id="edit-cancel-button">キャンセル</button>
          <button type="button" class="btn btn-primary" id="edit-save-button">更新</button>
        </div>
      </div>
    </div>

    <div id="confirm-dialog" class="modal" role="dialog" aria-modal="true" aria-labelledby="confirm-dialog-title" hidden>
      <div class="modal-backdrop" data-dialog-dismiss="true"></div>
      <div class="modal-panel">
        <div class="modal-header">
          <h2 id="confirm-dialog-title">確認</h2>
        </div>
        <div class="modal-body">
          <p id="confirm-dialog-message"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-ghost" id="confirm-cancel-button" data-dialog-dismiss="true">キャンセル</button>
          <button type="button" class="btn btn-danger" id="confirm-accept-button">実行する</button>
        </div>
      </div>
    </div>

    <footer class="site-footer">
      <div class="credit-line">Created by <span class="credit-highlight">23schop Maruo Kyohei</span></div>
      <div class="credit-line">&copy; <span id="copyright-year">2025</span> Hirosaki Hirosaki Univ. Co-op. SCHOP</div>
    </footer>

    <script type="module" src="scripts/operator/index.js"></script>
</body>
</html>
